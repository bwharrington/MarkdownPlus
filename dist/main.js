(()=>{"use strict";var e={157:e=>{e.exports=require("electron")},915:function(e,n,i){var t,o=this&&this.__createBinding||(Object.create?function(e,n,i,t){void 0===t&&(t=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(e,t,o)}:function(e,n,i,t){void 0===t&&(t=i),e[t]=n[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(t=function(e){return t=Object.getOwnPropertyNames||function(e){var n=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[n.length]=i);return n},t(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i=t(e),l=0;l<i.length;l++)"default"!==i[l]&&o(n,e,i[l]);return r(n,e),n}),s=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function l(e){try{a(t.next(e))}catch(e){r(e)}}function s(e){try{a(t.throw(e))}catch(e){r(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,s)}a((t=t.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const a=i(157),c=l(i(928)),d=l(i(943));let u,f=[];const h=()=>{const e=a.app.isPackaged?c.dirname(a.app.getPath("exe")):a.app.getAppPath();return c.join(e,"config.json")},p={recentFiles:[],openFiles:[],defaultLineEnding:"CRLF"};function v(e){return e.includes("\r\n")?"CRLF":"LF"}function g(e,n){const i=e.replace(/\r\n/g,"\n");return"CRLF"===n?i.replace(/\n/g,"\r\n"):i}function m(){return s(this,void 0,void 0,(function*(){try{const e=h(),n=yield d.readFile(e,"utf-8");return Object.assign(Object.assign({},p),JSON.parse(n))}catch(e){return p}}))}function y(e){return s(this,void 0,void 0,(function*(){try{const n=h();yield d.writeFile(n,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save config:",e)}}))}a.app.whenReady().then((()=>s(void 0,void 0,void 0,(function*(){const e=process.argv.slice(1);console.log("Command line args:",e),f=e.filter((e=>{const n=e.toLowerCase(),i=n.endsWith(".md")||n.endsWith(".markdown"),t=!e.startsWith("--")&&!e.startsWith("-");return i&&t})),console.log("Pending files to open:",f),function(){a.ipcMain.handle("file:open",(()=>s(this,void 0,void 0,(function*(){const e=yield a.dialog.showOpenDialog(u,{filters:[{name:"Markdown",extensions:["md","markdown"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}],properties:["openFile","multiSelections"]});if(e.canceled||0===e.filePaths.length)return null;const n=[];for(const i of e.filePaths)try{const e=yield d.readFile(i,"utf-8"),t=v(e);n.push({filePath:i,content:e,lineEnding:t})}catch(e){console.error(`Failed to read file ${i}:`,e)}return n.length>0?n:null})))),a.ipcMain.handle("file:read",((e,n)=>s(this,void 0,void 0,(function*(){try{const e=yield d.readFile(n,"utf-8"),i=v(e);return{filePath:n,content:e,lineEnding:i}}catch(e){return console.error("Failed to read file:",e),null}})))),a.ipcMain.handle("file:save",((e,n,i)=>s(this,void 0,void 0,(function*(){try{let e="LF";try{e=v(yield d.readFile(n,"utf-8"))}catch(n){e="win32"===process.platform?"CRLF":"LF"}const t=g(i,e);return yield d.writeFile(n,t,"utf-8"),{success:!0,filePath:n}}catch(e){return console.error("Failed to save file:",e),{success:!1,filePath:n,error:String(e)}}})))),a.ipcMain.handle("file:save-as",((e,n,i)=>s(this,void 0,void 0,(function*(){const e=yield a.dialog.showSaveDialog(u,{defaultPath:i||"Untitled.md",filters:[{name:"Markdown",extensions:["md"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}]});if(e.canceled||!e.filePath)return null;try{const i="win32"===process.platform?"CRLF":"LF",t=g(n,i);return yield d.writeFile(e.filePath,t,"utf-8"),{success:!0,filePath:e.filePath}}catch(n){return console.error("Failed to save file:",n),{success:!1,filePath:e.filePath,error:String(n)}}})))),a.ipcMain.handle("file:rename",((e,n,i)=>s(this,void 0,void 0,(function*(){try{return yield d.rename(n,i),{success:!0}}catch(e){throw console.error("Failed to rename file:",e),e}})))),a.ipcMain.handle("config:load",(()=>s(this,void 0,void 0,(function*(){return yield m()})))),a.ipcMain.handle("config:save",((e,n)=>s(this,void 0,void 0,(function*(){yield y(n)})))),a.ipcMain.handle("config:open",(()=>s(this,void 0,void 0,(function*(){return yield function(){return s(this,void 0,void 0,(function*(){const e=h();try{try{yield d.access(e)}catch(n){yield d.writeFile(e,JSON.stringify(p,null,2),"utf-8")}const n=yield d.readFile(e,"utf-8");return{filePath:e,content:n,lineEnding:v(n)}}catch(e){return console.error("Failed to open config file:",e),null}}))}()})))),a.ipcMain.handle("get-initial-files",(()=>{const e=f;return f=[],e})),a.ipcMain.handle("config:sync-recent-files",((e,n)=>s(this,void 0,void 0,(function*(){const e=yield m(),i=Object.assign(Object.assign({},e),{recentFiles:n,openFiles:n});yield y(i)})))),a.ipcMain.handle("dialog:confirm-close",((e,n)=>s(this,void 0,void 0,(function*(){return{action:["save","discard","cancel"][(yield a.dialog.showMessageBox(u,{type:"question",buttons:["Save","Don't Save","Cancel"],defaultId:0,cancelId:2,title:"Unsaved Changes",message:`Do you want to save changes to "${n}"?`,detail:"Your changes will be lost if you don't save them."})).response]}})))),a.ipcMain.handle("dialog:external-change",((e,n)=>s(this,void 0,void 0,(function*(){return 0===(yield a.dialog.showMessageBox(u,{type:"question",buttons:["Reload","Keep Current"],defaultId:0,title:"File Changed",message:`"${n}" has been modified externally.`,detail:"Do you want to reload the file or keep your current version?"})).response?"reload":"keep"})))),a.ipcMain.handle("window:set-title",((e,n)=>s(this,void 0,void 0,(function*(){null==u||u.setTitle(n)})))),a.ipcMain.handle("window:get-bounds",(()=>s(this,void 0,void 0,(function*(){return null==u?void 0:u.getBounds()})))),a.ipcMain.handle("window:minimize",(()=>s(this,void 0,void 0,(function*(){null==u||u.minimize()})))),a.ipcMain.handle("window:maximize",(()=>s(this,void 0,void 0,(function*(){(null==u?void 0:u.isMaximized())?u.unmaximize():null==u||u.maximize()})))),a.ipcMain.handle("window:close",(()=>s(this,void 0,void 0,(function*(){null==u||u.close()})))),a.ipcMain.handle("shell:show-in-folder",((e,n)=>s(this,void 0,void 0,(function*(){a.shell.showItemInFolder(n)}))))}(),a.Menu.setApplicationMenu(null),u=new a.BrowserWindow({width:1200,height:800,minWidth:600,minHeight:400,frame:!1,icon:c.join(__dirname,"assets","MarkdownPlus.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}}),u.loadFile(c.join(__dirname,"index.html")),u.on("closed",(()=>{u=null}))})))),a.app.on("second-instance",((e,n)=>{console.log("Second instance command line:",n),u&&(u.isMinimized()&&u.restore(),u.focus());const i=n.slice(1).filter((e=>{const n=e.toLowerCase(),i=n.endsWith(".md")||n.endsWith(".markdown"),t=!e.startsWith("--")&&!e.startsWith("-");return i&&t}));console.log("Second instance files to open:",i),i.length>0&&u&&!u.isDestroyed()&&u.webContents.send("open-files-from-args",i)})),a.app.requestSingleInstanceLock()||a.app.quit()},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")}},n={};!function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}(915)})();