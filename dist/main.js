(()=>{"use strict";var e={157:e=>{e.exports=require("electron")},530:function(e,n,t){var i,o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,o)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},i(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=i(e),l=0;l<t.length;l++)"default"!==t[l]&&o(n,e,t[l]);return r(n,e),n}),s=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,s)}a((i=i.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.initLogger=function(){const e=d.app.isPackaged?c.dirname(d.app.getPath("exe")):d.app.getAppPath();u=c.join(e,"markdownplus-debug.log");try{a.writeFile(u,"=== MarkdownPlus Debug Log ===\n","utf-8").catch((()=>{}))}catch(e){}p("Logger initialized",{appPath:e,logFilePath:u,isPackaged:d.app.isPackaged})},n.log=p,n.logError=function(e,n){const t=(new Date).toISOString(),i=Object.assign({message:(null==n?void 0:n.message)||String(n),stack:null==n?void 0:n.stack},n),o=`[${t}] ERROR: ${e}\n${JSON.stringify(i,null,2)}\n\n`;console.error(`[ERROR] ${e}`,n),f.push(o),setTimeout(h,100)},n.flushLogsSync=function(){return s(this,void 0,void 0,(function*(){yield h()}))},n.getLogFilePath=function(){return u};const a=l(t(943)),c=l(t(928)),d=t(157);let u,f=[],g=!1;function h(){return s(this,void 0,void 0,(function*(){if(g||0===f.length)return;g=!0;const e=[...f];f=[];try{yield a.appendFile(u,e.join(""),"utf-8")}catch(e){console.error("Failed to write logs:",e)}finally{g=!1}}))}function p(e,n){const t=(new Date).toISOString(),i=n?`[${t}] ${e}\n${JSON.stringify(n,null,2)}\n\n`:`[${t}] ${e}\n\n`;console.log(`[LOG] ${e}`,n||""),f.push(i),setTimeout(h,100)}},896:e=>{e.exports=require("fs")},915:function(e,n,t){var i,o=this&&this.__createBinding||(Object.create?function(e,n,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,o)}:function(e,n,t,i){void 0===i&&(i=t),e[i]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},i(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=i(e),l=0;l<t.length;l++)"default"!==t[l]&&o(n,e,t[l]);return r(n,e),n}),s=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function l(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(l,s)}a((i=i.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const a=t(157),c=l(t(928)),d=l(t(943)),u=l(t(896)),f=t(530);let g,h=[],p=new Map;const v=[".md",".markdown",".mdown",".mkd",".mkdn",".mdx",".mdwn"];function y(e){const n=e.toLowerCase();return v.some((e=>n.endsWith(e)))}const m=()=>{const e=a.app.isPackaged?c.dirname(a.app.getPath("exe")):a.app.getAppPath();return c.join(e,"config.json")},w={recentFiles:[],openFiles:[],defaultLineEnding:"CRLF",devToolsOpen:!1};function F(e){return e.includes("\r\n")?"CRLF":"LF"}function P(e,n){const t=e.replace(/\r\n/g,"\n");return"CRLF"===n?t.replace(/\n/g,"\r\n"):t}function O(){return s(this,void 0,void 0,(function*(){try{const e=m(),n=yield d.readFile(e,"utf-8"),t=JSON.parse(n);return t.recentFiles&&Array.isArray(t.recentFiles)&&t.recentFiles.length>0&&"string"==typeof t.recentFiles[0]&&(t.recentFiles=[]),t.openFiles&&Array.isArray(t.openFiles)&&t.openFiles.length>0&&"string"==typeof t.openFiles[0]&&(t.openFiles=[]),Object.assign(Object.assign({},w),t)}catch(e){return w}}))}function b(e){return s(this,void 0,void 0,(function*(){try{const n=m();yield d.writeFile(n,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save config:",e)}}))}a.app.whenReady().then((()=>s(void 0,void 0,void 0,(function*(){(0,f.initLogger)(),(0,f.log)("=== App Starting ==="),(0,f.log)("Electron app ready");const e=process.argv.slice(1);(0,f.log)("Command line arguments received",{args:e,length:e.length}),h=e.filter((e=>{const n=y(e),t=!e.startsWith("--")&&!e.startsWith("-"),i=n&&t;return(0,f.log)("Filtering argument",{arg:e,isMarkdown:n,isNotFlag:t,included:i}),i})),(0,f.log)("Pending files to open after filtering",{pendingFilesToOpen:h,count:h.length}),(0,f.log)("Registering IPC handlers"),function(){a.ipcMain.handle("file:open",(()=>s(this,void 0,void 0,(function*(){const e=yield a.dialog.showOpenDialog(g,{filters:[{name:"Markdown",extensions:["md","markdown","mdown","mkd","mkdn","mdx","mdwn"]},{name:"Text Files",extensions:["txt"]},{name:"Other Markup",extensions:["rst","adoc","asciidoc","org","textile"]},{name:"All Files",extensions:["*"]}],properties:["openFile","multiSelections"]});if(e.canceled||0===e.filePaths.length)return null;const n=[];for(const t of e.filePaths)try{const e=yield d.readFile(t,"utf-8"),i=F(e);n.push({filePath:t,content:e,lineEnding:i})}catch(e){console.error(`Failed to read file ${t}:`,e)}return n.length>0?n:null})))),a.ipcMain.handle("file:read",((e,n)=>s(this,void 0,void 0,(function*(){(0,f.log)("IPC: file:read called",{filePath:n});try{const e=yield d.readFile(n,"utf-8"),t=F(e);return(0,f.log)("IPC: file:read success",{filePath:n,contentLength:e.length,lineEnding:t}),{filePath:n,content:e,lineEnding:t}}catch(e){return(0,f.logError)("IPC: file:read failed",e),null}})))),a.ipcMain.handle("file:save",((e,n,t)=>s(this,void 0,void 0,(function*(){try{let e="LF";try{e=F(yield d.readFile(n,"utf-8"))}catch(n){e="win32"===process.platform?"CRLF":"LF"}const i=P(t,e);return yield d.writeFile(n,i,"utf-8"),{success:!0,filePath:n}}catch(e){return console.error("Failed to save file:",e),{success:!1,filePath:n,error:String(e)}}})))),a.ipcMain.handle("file:save-as",((e,n,t)=>s(this,void 0,void 0,(function*(){const e=yield a.dialog.showSaveDialog(g,{defaultPath:t||"Untitled.md",filters:[{name:"Markdown",extensions:["md"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}]});if(e.canceled||!e.filePath)return null;try{const t="win32"===process.platform?"CRLF":"LF",i=P(n,t);return yield d.writeFile(e.filePath,i,"utf-8"),{success:!0,filePath:e.filePath}}catch(n){return console.error("Failed to save file:",n),{success:!1,filePath:e.filePath,error:String(n)}}})))),a.ipcMain.handle("file:rename",((e,n,t)=>s(this,void 0,void 0,(function*(){try{return yield d.rename(n,t),{success:!0}}catch(e){throw console.error("Failed to rename file:",e),e}})))),a.ipcMain.handle("config:load",(()=>s(this,void 0,void 0,(function*(){return yield O()})))),a.ipcMain.handle("config:save",((e,n)=>s(this,void 0,void 0,(function*(){yield b(n)})))),a.ipcMain.handle("config:open",(()=>s(this,void 0,void 0,(function*(){return yield function(){return s(this,void 0,void 0,(function*(){const e=m();try{try{yield d.access(e)}catch(n){yield d.writeFile(e,JSON.stringify(w,null,2),"utf-8")}const n=yield d.readFile(e,"utf-8");return{filePath:e,content:n,lineEnding:F(n)}}catch(e){return console.error("Failed to open config file:",e),null}}))}()})))),a.ipcMain.handle("get-initial-files",(()=>{(0,f.log)("IPC: get-initial-files called",{pendingFiles:h});const e=h;return h=[],(0,f.log)("IPC: Returning files and clearing pending",{files:e}),e})),a.ipcMain.handle("renderer-ready",(()=>{if((0,f.log)("IPC: renderer-ready called",{pendingFiles:h}),h.length>0&&g&&!g.isDestroyed()){(0,f.log)("Sending files to renderer after ready signal",{files:h}),g.webContents.send("open-files-from-args",h),(0,f.log)('IPC event "open-files-from-args" sent to renderer');const e=[...h];return h=[],(0,f.log)("Returning files from renderer-ready",{files:e}),e}return(0,f.log)("No files to send from renderer-ready"),[]})),a.ipcMain.handle("config:sync-recent-files",((e,n)=>s(this,void 0,void 0,(function*(){const e=yield O(),t=Object.assign(Object.assign({},e),{recentFiles:n,openFiles:n});yield b(t)})))),a.ipcMain.handle("dialog:confirm-close",((e,n)=>s(this,void 0,void 0,(function*(){return{action:["save","discard","cancel"][(yield a.dialog.showMessageBox(g,{type:"question",buttons:["Save","Don't Save","Cancel"],defaultId:0,cancelId:2,title:"Unsaved Changes",message:`Do you want to save changes to "${n}"?`,detail:"Your changes will be lost if you don't save them."})).response]}})))),a.ipcMain.handle("devtools:toggle",(()=>s(this,void 0,void 0,(function*(){return!(!g||g.isDestroyed()||(g.webContents.isDevToolsOpened()?(g.webContents.closeDevTools(),1):(g.webContents.openDevTools(),0)))})))),a.ipcMain.handle("devtools:get-state",(()=>s(this,void 0,void 0,(function*(){return!(!g||g.isDestroyed())&&g.webContents.isDevToolsOpened()})))),a.ipcMain.handle("log:get-path",(()=>(0,f.getLogFilePath)())),a.ipcMain.on("console:log",((e,n,...t)=>{const i=t.map((e=>"object"==typeof e?JSON.stringify(e):String(e))).join(" ");(0,f.log)(`[RENDERER ${n.toUpperCase()}] ${i}`)})),a.ipcMain.handle("dialog:external-change",((e,n)=>s(this,void 0,void 0,(function*(){return 0===(yield a.dialog.showMessageBox(g,{type:"question",buttons:["Reload","Keep Current"],defaultId:0,title:"File Changed",message:`"${n}" has been modified externally.`,detail:"Do you want to reload the file or keep your current version?"})).response?"reload":"keep"})))),a.ipcMain.handle("window:set-title",((e,n)=>s(this,void 0,void 0,(function*(){null==g||g.setTitle(n)})))),a.ipcMain.handle("window:get-bounds",(()=>s(this,void 0,void 0,(function*(){return null==g?void 0:g.getBounds()})))),a.ipcMain.handle("window:minimize",(()=>s(this,void 0,void 0,(function*(){null==g||g.minimize()})))),a.ipcMain.handle("window:maximize",(()=>s(this,void 0,void 0,(function*(){(null==g?void 0:g.isMaximized())?g.unmaximize():null==g||g.maximize()})))),a.ipcMain.handle("window:close",(()=>s(this,void 0,void 0,(function*(){null==g||g.close()})))),a.ipcMain.handle("shell:show-in-folder",((e,n)=>s(this,void 0,void 0,(function*(){a.shell.showItemInFolder(n)})))),a.ipcMain.handle("file:watch",((e,n)=>s(this,void 0,void 0,(function*(){!function(e){if(!p.has(e))try{const n=u.watch(e,(n=>{"change"===n&&((0,f.log)("File changed externally",{filePath:e}),g&&!g.isDestroyed()&&g.webContents.send("file:external-change",e))}));p.set(e,n),(0,f.log)("Started watching file",{filePath:e})}catch(n){(0,f.logError)(`Failed to watch file: ${e}`,n)}}(n)})))),a.ipcMain.handle("file:unwatch",((e,n)=>s(this,void 0,void 0,(function*(){!function(e){const n=p.get(e);n&&(n.close(),p.delete(e),(0,f.log)("Stopped watching file",{filePath:e}))}(n)}))))}(),a.Menu.setApplicationMenu(null),(0,f.log)("Creating main window"),function(){g=new a.BrowserWindow({width:1200,height:800,minWidth:600,minHeight:400,frame:!1,icon:c.join(__dirname,"assets","win32"===process.platform?"icon.ico":"MarkdownPlus.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}}),g.loadFile(c.join(__dirname,"index.html")),O().then((e=>{e.devToolsOpen&&g&&!g.isDestroyed()&&((0,f.log)("Opening DevTools from config",{devToolsOpen:e.devToolsOpen}),g.webContents.openDevTools())})),g.webContents.on("devtools-opened",(()=>s(this,void 0,void 0,(function*(){(0,f.log)("DevTools opened via native UI");const e=yield O();yield b(Object.assign(Object.assign({},e),{devToolsOpen:!0}))})))),g.webContents.on("devtools-closed",(()=>s(this,void 0,void 0,(function*(){(0,f.log)("DevTools closed via native UI");const e=yield O();yield b(Object.assign(Object.assign({},e),{devToolsOpen:!1}))})))),g.on("closed",(()=>{g=null}))}(),(0,f.log)("Main window created")})))),a.app.on("second-instance",((e,n)=>{(0,f.log)("Second instance detected",{commandLine:n}),g&&(g.isMinimized()&&g.restore(),g.focus());const t=n.slice(1);(0,f.log)("Second instance args",{args:t});const i=t.filter((e=>{const n=y(e),t=!e.startsWith("--")&&!e.startsWith("-");return n&&t}));(0,f.log)("Second instance files to open",{filesToOpen:i}),i.length>0&&g&&!g.isDestroyed()&&((0,f.log)("Sending second instance files to renderer",{filesToOpen:i}),g.webContents.send("open-files-from-args",i))})),a.app.requestSingleInstanceLock()||a.app.quit(),a.app.on("before-quit",(()=>s(void 0,void 0,void 0,(function*(){(0,f.log)("App quitting, flushing logs"),yield(0,f.flushLogsSync)()}))))},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")}},n={};!function t(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return e[i].call(r.exports,r,r.exports,t),r.exports}(915)})();