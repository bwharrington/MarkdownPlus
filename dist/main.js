(()=>{"use strict";var e={157:e=>{e.exports=require("electron")},915:function(e,n,i){var t,o=this&&this.__createBinding||(Object.create?function(e,n,i,t){void 0===t&&(t=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(e,t,o)}:function(e,n,i,t){void 0===t&&(t=i),e[t]=n[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(t=function(e){return t=Object.getOwnPropertyNames||function(e){var n=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[n.length]=i);return n},t(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i=t(e),l=0;l<i.length;l++)"default"!==i[l]&&o(n,e,i[l]);return r(n,e),n}),a=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function l(e){try{s(t.next(e))}catch(e){r(e)}}function a(e){try{s(t.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,a)}s((t=t.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const s=i(157),c=l(i(928)),d=l(i(943));let u;const f=()=>{const e=s.app.isPackaged?c.dirname(s.app.getPath("exe")):s.app.getAppPath();return c.join(e,"config.json")},h={recentFiles:[],openFiles:[],defaultLineEnding:"CRLF"};function p(e){return e.includes("\r\n")?"CRLF":"LF"}function v(e,n){const i=e.replace(/\r\n/g,"\n");return"CRLF"===n?i.replace(/\n/g,"\r\n"):i}function g(){return a(this,void 0,void 0,(function*(){try{const e=f(),n=yield d.readFile(e,"utf-8");return Object.assign(Object.assign({},h),JSON.parse(n))}catch(e){return h}}))}function y(e){return a(this,void 0,void 0,(function*(){try{const n=f();yield d.writeFile(n,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save config:",e)}}))}function w(){u=new s.BrowserWindow({width:1200,height:800,minWidth:600,minHeight:400,frame:!1,icon:c.join(__dirname,"assets","MarkdownPlus.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}}),u.loadFile(c.join(__dirname,"index.html")),u.on("closed",(()=>{u=null}))}s.app.whenReady().then((()=>a(void 0,void 0,void 0,(function*(){(function(){s.ipcMain.handle("file:open",(()=>a(this,void 0,void 0,(function*(){const e=yield s.dialog.showOpenDialog(u,{filters:[{name:"Markdown",extensions:["md","markdown"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}],properties:["openFile","multiSelections"]});if(e.canceled||0===e.filePaths.length)return null;const n=[];for(const i of e.filePaths)try{const e=yield d.readFile(i,"utf-8"),t=p(e);n.push({filePath:i,content:e,lineEnding:t})}catch(e){console.error(`Failed to read file ${i}:`,e)}return n.length>0?n:null})))),s.ipcMain.handle("file:read",((e,n)=>a(this,void 0,void 0,(function*(){try{const e=yield d.readFile(n,"utf-8"),i=p(e);return{filePath:n,content:e,lineEnding:i}}catch(e){return console.error("Failed to read file:",e),null}})))),s.ipcMain.handle("file:save",((e,n,i)=>a(this,void 0,void 0,(function*(){try{let e="LF";try{e=p(yield d.readFile(n,"utf-8"))}catch(n){e="win32"===process.platform?"CRLF":"LF"}const t=v(i,e);return yield d.writeFile(n,t,"utf-8"),{success:!0,filePath:n}}catch(e){return console.error("Failed to save file:",e),{success:!1,filePath:n,error:String(e)}}})))),s.ipcMain.handle("file:save-as",((e,n,i)=>a(this,void 0,void 0,(function*(){const e=yield s.dialog.showSaveDialog(u,{defaultPath:i||"Untitled.md",filters:[{name:"Markdown",extensions:["md"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}]});if(e.canceled||!e.filePath)return null;try{const i="win32"===process.platform?"CRLF":"LF",t=v(n,i);return yield d.writeFile(e.filePath,t,"utf-8"),{success:!0,filePath:e.filePath}}catch(n){return console.error("Failed to save file:",n),{success:!1,filePath:e.filePath,error:String(n)}}})))),s.ipcMain.handle("config:load",(()=>a(this,void 0,void 0,(function*(){return yield g()})))),s.ipcMain.handle("config:save",((e,n)=>a(this,void 0,void 0,(function*(){yield y(n)})))),s.ipcMain.handle("config:open",(()=>a(this,void 0,void 0,(function*(){return yield function(){return a(this,void 0,void 0,(function*(){const e=f();try{try{yield d.access(e)}catch(n){yield d.writeFile(e,JSON.stringify(h,null,2),"utf-8")}const n=yield d.readFile(e,"utf-8");return{filePath:e,content:n,lineEnding:p(n)}}catch(e){return console.error("Failed to open config file:",e),null}}))}()})))),s.ipcMain.handle("config:sync-recent-files",((e,n)=>a(this,void 0,void 0,(function*(){const e=yield g(),i=Object.assign(Object.assign({},e),{recentFiles:n,openFiles:n});yield y(i)})))),s.ipcMain.handle("dialog:confirm-close",((e,n)=>a(this,void 0,void 0,(function*(){return{action:["save","discard","cancel"][(yield s.dialog.showMessageBox(u,{type:"question",buttons:["Save","Don't Save","Cancel"],defaultId:0,cancelId:2,title:"Unsaved Changes",message:`Do you want to save changes to "${n}"?`,detail:"Your changes will be lost if you don't save them."})).response]}})))),s.ipcMain.handle("dialog:external-change",((e,n)=>a(this,void 0,void 0,(function*(){return 0===(yield s.dialog.showMessageBox(u,{type:"question",buttons:["Reload","Keep Current"],defaultId:0,title:"File Changed",message:`"${n}" has been modified externally.`,detail:"Do you want to reload the file or keep your current version?"})).response?"reload":"keep"})))),s.ipcMain.handle("window:set-title",((e,n)=>a(this,void 0,void 0,(function*(){null==u||u.setTitle(n)})))),s.ipcMain.handle("window:get-bounds",(()=>a(this,void 0,void 0,(function*(){return null==u?void 0:u.getBounds()})))),s.ipcMain.handle("window:minimize",(()=>a(this,void 0,void 0,(function*(){null==u||u.minimize()})))),s.ipcMain.handle("window:maximize",(()=>a(this,void 0,void 0,(function*(){(null==u?void 0:u.isMaximized())?u.unmaximize():null==u||u.maximize()})))),s.ipcMain.handle("window:close",(()=>a(this,void 0,void 0,(function*(){null==u||u.close()})))),s.ipcMain.handle("shell:show-in-folder",((e,n)=>a(this,void 0,void 0,(function*(){s.shell.showItemInFolder(n)}))))})(),s.Menu.setApplicationMenu(null),w()})))),s.app.on("window-all-closed",(()=>{"darwin"!==process.platform&&s.app.quit()})),s.app.on("activate",(()=>{null===u&&w()}))},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")}},n={};!function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}(915)})();