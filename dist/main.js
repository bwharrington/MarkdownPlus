(()=>{"use strict";var e={157:e=>{e.exports=require("electron")},530:function(e,n,i){var t,o=this&&this.__createBinding||(Object.create?function(e,n,i,t){void 0===t&&(t=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(e,t,o)}:function(e,n,i,t){void 0===t&&(t=i),e[t]=n[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(t=function(e){return t=Object.getOwnPropertyNames||function(e){var n=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[n.length]=i);return n},t(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i=t(e),l=0;l<i.length;l++)"default"!==i[l]&&o(n,e,i[l]);return r(n,e),n}),a=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function l(e){try{s(t.next(e))}catch(e){r(e)}}function a(e){try{s(t.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,a)}s((t=t.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.initLogger=function(){const e=d.app.isPackaged?c.dirname(d.app.getPath("exe")):d.app.getAppPath();u=c.join(e,"markdownplus-debug.log");try{s.writeFile(u,"=== MarkdownPlus Debug Log ===\n","utf-8").catch((()=>{}))}catch(e){}p("Logger initialized",{appPath:e,logFilePath:u,isPackaged:d.app.isPackaged})},n.log=p,n.logError=function(e,n){const i=(new Date).toISOString(),t=Object.assign({message:(null==n?void 0:n.message)||String(n),stack:null==n?void 0:n.stack},n),o=`[${i}] ERROR: ${e}\n${JSON.stringify(t,null,2)}\n\n`;console.error(`[ERROR] ${e}`,n),f.push(o),setTimeout(h,100)},n.flushLogsSync=function(){return a(this,void 0,void 0,(function*(){yield h()}))};const s=l(i(943)),c=l(i(928)),d=i(157);let u,f=[],g=!1;function h(){return a(this,void 0,void 0,(function*(){if(g||0===f.length)return;g=!0;const e=[...f];f=[];try{yield s.appendFile(u,e.join(""),"utf-8")}catch(e){console.error("Failed to write logs:",e)}finally{g=!1}}))}function p(e,n){const i=(new Date).toISOString(),t=n?`[${i}] ${e}\n${JSON.stringify(n,null,2)}\n\n`:`[${i}] ${e}\n\n`;console.log(`[LOG] ${e}`,n||""),f.push(t),setTimeout(h,100)}},915:function(e,n,i){var t,o=this&&this.__createBinding||(Object.create?function(e,n,i,t){void 0===t&&(t=i);var o=Object.getOwnPropertyDescriptor(n,i);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(e,t,o)}:function(e,n,i,t){void 0===t&&(t=i),e[t]=n[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),l=this&&this.__importStar||(t=function(e){return t=Object.getOwnPropertyNames||function(e){var n=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[n.length]=i);return n},t(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i=t(e),l=0;l<i.length;l++)"default"!==i[l]&&o(n,e,i[l]);return r(n,e),n}),a=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function l(e){try{s(t.next(e))}catch(e){r(e)}}function a(e){try{s(t.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,a)}s((t=t.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const s=i(157),c=l(i(928)),d=l(i(943)),u=i(530);let f,g=[];const h=()=>{const e=s.app.isPackaged?c.dirname(s.app.getPath("exe")):s.app.getAppPath();return c.join(e,"config.json")},p={recentFiles:[],openFiles:[],defaultLineEnding:"CRLF"};function v(e){return e.includes("\r\n")?"CRLF":"LF"}function y(e,n){const i=e.replace(/\r\n/g,"\n");return"CRLF"===n?i.replace(/\n/g,"\r\n"):i}function m(){return a(this,void 0,void 0,(function*(){try{const e=h(),n=yield d.readFile(e,"utf-8");return Object.assign(Object.assign({},p),JSON.parse(n))}catch(e){return p}}))}function w(e){return a(this,void 0,void 0,(function*(){try{const n=h();yield d.writeFile(n,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save config:",e)}}))}s.app.whenReady().then((()=>a(void 0,void 0,void 0,(function*(){(0,u.initLogger)(),(0,u.log)("=== App Starting ==="),(0,u.log)("Electron app ready");const e=process.argv.slice(1);(0,u.log)("Command line arguments received",{args:e,length:e.length}),g=e.filter((e=>{const n=e.toLowerCase(),i=n.endsWith(".md")||n.endsWith(".markdown"),t=!e.startsWith("--")&&!e.startsWith("-"),o=i&&t;return(0,u.log)("Filtering argument",{arg:e,lowerArg:n,isMarkdown:i,isNotFlag:t,included:o}),o})),(0,u.log)("Pending files to open after filtering",{pendingFilesToOpen:g,count:g.length}),(0,u.log)("Registering IPC handlers"),function(){s.ipcMain.handle("file:open",(()=>a(this,void 0,void 0,(function*(){const e=yield s.dialog.showOpenDialog(f,{filters:[{name:"Markdown",extensions:["md","markdown"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}],properties:["openFile","multiSelections"]});if(e.canceled||0===e.filePaths.length)return null;const n=[];for(const i of e.filePaths)try{const e=yield d.readFile(i,"utf-8"),t=v(e);n.push({filePath:i,content:e,lineEnding:t})}catch(e){console.error(`Failed to read file ${i}:`,e)}return n.length>0?n:null})))),s.ipcMain.handle("file:read",((e,n)=>a(this,void 0,void 0,(function*(){(0,u.log)("IPC: file:read called",{filePath:n});try{const e=yield d.readFile(n,"utf-8"),i=v(e);return(0,u.log)("IPC: file:read success",{filePath:n,contentLength:e.length,lineEnding:i}),{filePath:n,content:e,lineEnding:i}}catch(e){return(0,u.logError)("IPC: file:read failed",e),null}})))),s.ipcMain.handle("file:save",((e,n,i)=>a(this,void 0,void 0,(function*(){try{let e="LF";try{e=v(yield d.readFile(n,"utf-8"))}catch(n){e="win32"===process.platform?"CRLF":"LF"}const t=y(i,e);return yield d.writeFile(n,t,"utf-8"),{success:!0,filePath:n}}catch(e){return console.error("Failed to save file:",e),{success:!1,filePath:n,error:String(e)}}})))),s.ipcMain.handle("file:save-as",((e,n,i)=>a(this,void 0,void 0,(function*(){const e=yield s.dialog.showSaveDialog(f,{defaultPath:i||"Untitled.md",filters:[{name:"Markdown",extensions:["md"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}]});if(e.canceled||!e.filePath)return null;try{const i="win32"===process.platform?"CRLF":"LF",t=y(n,i);return yield d.writeFile(e.filePath,t,"utf-8"),{success:!0,filePath:e.filePath}}catch(n){return console.error("Failed to save file:",n),{success:!1,filePath:e.filePath,error:String(n)}}})))),s.ipcMain.handle("file:rename",((e,n,i)=>a(this,void 0,void 0,(function*(){try{return yield d.rename(n,i),{success:!0}}catch(e){throw console.error("Failed to rename file:",e),e}})))),s.ipcMain.handle("config:load",(()=>a(this,void 0,void 0,(function*(){return yield m()})))),s.ipcMain.handle("config:save",((e,n)=>a(this,void 0,void 0,(function*(){yield w(n)})))),s.ipcMain.handle("config:open",(()=>a(this,void 0,void 0,(function*(){return yield function(){return a(this,void 0,void 0,(function*(){const e=h();try{try{yield d.access(e)}catch(n){yield d.writeFile(e,JSON.stringify(p,null,2),"utf-8")}const n=yield d.readFile(e,"utf-8");return{filePath:e,content:n,lineEnding:v(n)}}catch(e){return console.error("Failed to open config file:",e),null}}))}()})))),s.ipcMain.handle("get-initial-files",(()=>{(0,u.log)("IPC: get-initial-files called",{pendingFiles:g});const e=g;return g=[],(0,u.log)("IPC: Returning files and clearing pending",{files:e}),e})),s.ipcMain.handle("renderer-ready",(()=>{if((0,u.log)("IPC: renderer-ready called",{pendingFiles:g}),g.length>0&&f&&!f.isDestroyed()){(0,u.log)("Sending files to renderer after ready signal",{files:g}),f.webContents.send("open-files-from-args",g),(0,u.log)('IPC event "open-files-from-args" sent to renderer');const e=[...g];return g=[],(0,u.log)("Returning files from renderer-ready",{files:e}),e}return(0,u.log)("No files to send from renderer-ready"),[]})),s.ipcMain.handle("config:sync-recent-files",((e,n)=>a(this,void 0,void 0,(function*(){const e=yield m(),i=Object.assign(Object.assign({},e),{recentFiles:n,openFiles:n});yield w(i)})))),s.ipcMain.handle("dialog:confirm-close",((e,n)=>a(this,void 0,void 0,(function*(){return{action:["save","discard","cancel"][(yield s.dialog.showMessageBox(f,{type:"question",buttons:["Save","Don't Save","Cancel"],defaultId:0,cancelId:2,title:"Unsaved Changes",message:`Do you want to save changes to "${n}"?`,detail:"Your changes will be lost if you don't save them."})).response]}})))),s.ipcMain.handle("dialog:external-change",((e,n)=>a(this,void 0,void 0,(function*(){return 0===(yield s.dialog.showMessageBox(f,{type:"question",buttons:["Reload","Keep Current"],defaultId:0,title:"File Changed",message:`"${n}" has been modified externally.`,detail:"Do you want to reload the file or keep your current version?"})).response?"reload":"keep"})))),s.ipcMain.handle("window:set-title",((e,n)=>a(this,void 0,void 0,(function*(){null==f||f.setTitle(n)})))),s.ipcMain.handle("window:get-bounds",(()=>a(this,void 0,void 0,(function*(){return null==f?void 0:f.getBounds()})))),s.ipcMain.handle("window:minimize",(()=>a(this,void 0,void 0,(function*(){null==f||f.minimize()})))),s.ipcMain.handle("window:maximize",(()=>a(this,void 0,void 0,(function*(){(null==f?void 0:f.isMaximized())?f.unmaximize():null==f||f.maximize()})))),s.ipcMain.handle("window:close",(()=>a(this,void 0,void 0,(function*(){null==f||f.close()})))),s.ipcMain.handle("shell:show-in-folder",((e,n)=>a(this,void 0,void 0,(function*(){s.shell.showItemInFolder(n)}))))}(),s.Menu.setApplicationMenu(null),(0,u.log)("Creating main window"),f=new s.BrowserWindow({width:1200,height:800,minWidth:600,minHeight:400,frame:!1,icon:c.join(__dirname,"assets","MarkdownPlus.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}}),f.loadFile(c.join(__dirname,"index.html")),g.length>0&&((0,u.log)("Opening DevTools",{isDev:!1,hasPendingFiles:g.length>0}),f.webContents.openDevTools()),f.on("closed",(()=>{f=null})),(0,u.log)("Main window created")})))),s.app.on("second-instance",((e,n)=>{(0,u.log)("Second instance detected",{commandLine:n}),f&&(f.isMinimized()&&f.restore(),f.focus());const i=n.slice(1);(0,u.log)("Second instance args",{args:i});const t=i.filter((e=>{const n=e.toLowerCase(),i=n.endsWith(".md")||n.endsWith(".markdown"),t=!e.startsWith("--")&&!e.startsWith("-");return i&&t}));(0,u.log)("Second instance files to open",{filesToOpen:t}),t.length>0&&f&&!f.isDestroyed()&&((0,u.log)("Sending second instance files to renderer",{filesToOpen:t}),f.webContents.send("open-files-from-args",t))})),s.app.requestSingleInstanceLock()||s.app.quit(),s.app.on("before-quit",(()=>a(void 0,void 0,void 0,(function*(){(0,u.log)("App quitting, flushing logs"),yield(0,u.flushLogsSync)()}))))},928:e=>{e.exports=require("path")},943:e=>{e.exports=require("fs/promises")}},n={};!function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}(915)})();