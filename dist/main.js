(()=>{var e={56:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.5.0","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","pretest":"npm run lint && npm run dts-check","test":"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"homepage":"https://github.com/motdotla/dotenv#readme","funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^18.11.3","decache":"^4.6.2","sinon":"^14.0.1","standard":"^17.0.0","standard-version":"^9.5.0","tap":"^19.2.0","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')},157:e=>{"use strict";e.exports=require("electron")},337:function(e,t,n){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.registerAIIpcHandlers=function(){(0,u.log)("Registering AI IPC handlers"),l.ipcMain.handle("ai:chat-request",((e,t)=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: chat-request",{model:t.model,messageCount:t.messages.length});try{return{success:!0,response:yield(0,p.callXAiApi)(t.messages,t.model)}}catch(e){return(0,u.logError)("AI IPC: chat-request failed",e),{success:!1,error:e.message}}})))),l.ipcMain.handle("ai:claude-chat-request",((e,t)=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: claude-chat-request",{model:t.model,messageCount:t.messages.length});try{return{success:!0,response:yield(0,f.callClaudeApi)(t.messages,t.model)}}catch(e){return(0,u.logError)("AI IPC: claude-chat-request failed",e),{success:!1,error:e.message}}})))),l.ipcMain.handle("ai:list-models",(()=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: list-models");try{const e=(yield(0,p.listModels)()).map((e=>({id:e.id,displayName:m(e.id)})));return{success:!0,models:yield y("xai",e)}}catch(e){return(0,u.logError)("AI IPC: list-models failed, using defaults",e),{success:!0,models:yield y("xai",p.DEFAULT_XAI_MODELS)}}})))),l.ipcMain.handle("ai:list-claude-models",(()=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: list-claude-models");try{const e=(yield(0,f.listClaudeModels)()).map((e=>({id:e.id,displayName:e.display_name||m(e.id)})));return{success:!0,models:yield y("claude",e)}}catch(e){return(0,u.logError)("AI IPC: list-claude-models failed, using defaults",e),{success:!0,models:yield y("claude",f.DEFAULT_CLAUDE_MODELS)}}})))),l.ipcMain.handle("ai:openai-chat-request",((e,t)=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: openai-chat-request",{model:t.model,messageCount:t.messages.length});try{return{success:!0,response:yield(0,h.callOpenAIApi)(t.messages,t.model)}}catch(e){return(0,u.logError)("AI IPC: openai-chat-request failed",e),{success:!1,error:e.message}}})))),l.ipcMain.handle("ai:list-openai-models",(()=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: list-openai-models");try{const e=(yield(0,h.listOpenAIModels)()).map((e=>({id:e.id,displayName:m(e.id)})));return{success:!0,models:yield y("openai",e)}}catch(e){return(0,u.logError)("AI IPC: list-openai-models failed, using defaults",e),{success:!0,models:yield y("openai",h.DEFAULT_OPENAI_MODELS)}}})))),l.ipcMain.handle("ai:edit-request",((e,t)=>a(this,void 0,void 0,(function*(){if((0,u.log)("AI IPC: edit-request",{provider:t.provider,model:t.model,messageCount:t.messages.length}),"xai"===t.provider)return{success:!1,error:"Edit mode is not supported with xAI. Please switch to Claude or OpenAI."};try{let e;if("claude"===t.provider){const n=t.messages.map((e=>({role:e.role,content:e.content})));e=yield(0,f.callClaudeApiWithSystemPrompt)(n,g,t.model)}else{if("openai"!==t.provider)return{success:!1,error:`Unknown provider: ${t.provider}`};{const n=[{role:"system",content:g},...t.messages];e=yield(0,h.callOpenAIApiWithJsonMode)(n,t.model)}}try{let t=e.trim();t.startsWith("```json")&&(t=t.slice(7)),t.startsWith("```")&&(t=t.slice(3)),t.endsWith("```")&&(t=t.slice(0,-3)),t=t.trim();const n=JSON.parse(t);return n.modifiedContent?{success:!0,modifiedContent:n.modifiedContent,summary:n.summary||"Changes applied"}:{success:!1,error:"AI response missing modifiedContent field"}}catch(e){return(0,u.logError)("AI IPC: Failed to parse edit response as JSON",e),{success:!1,error:"Failed to parse AI response as JSON. The AI may not have returned valid JSON."}}}catch(e){return(0,u.logError)("AI IPC: edit-request failed",e),{success:!1,error:e.message}}})))),l.ipcMain.handle("ai:get-provider-status",(()=>a(this,void 0,void 0,(function*(){(0,u.log)("AI IPC: get-provider-status");const e={xai:{enabled:!1,status:"unchecked"},claude:{enabled:!1,status:"unchecked"},openai:{enabled:!1,status:"unchecked"}};if((0,p.hasApiKey)()){e.xai.enabled=!0;try{yield(0,p.listModels)(),e.xai.status="success"}catch(t){e.xai.status="error"}}if((0,f.hasApiKey)()){e.claude.enabled=!0;try{yield(0,f.listClaudeModels)(),e.claude.status="success"}catch(t){e.claude.status="error"}}if((0,h.hasApiKey)()){e.openai.enabled=!0;try{yield(0,h.listOpenAIModels)(),e.openai.status="success"}catch(t){e.openai.status="error"}}return(0,u.log)("AI IPC: provider status result",e),e})))),(0,u.log)("AI IPC handlers registered")};const l=n(157),c=s(n(928)),d=s(n(943)),u=n(530),p=n(779),f=n(359),h=n(979),g='You are helping edit a markdown document. The user will provide the current document content and request specific changes.\n\nRULES:\n1. Return a JSON object with "modifiedContent" (the complete modified document) and "summary" (brief description of changes)\n2. Preserve all content that the user did not ask to change\n3. Maintain the exact formatting, indentation, and line endings of unchanged sections\n4. Make ONLY the changes the user explicitly requested\n5. The modifiedContent must be the complete document, not a partial diff\n6. Your response MUST be valid JSON and nothing else\n\nExample response format:\n{\n  "modifiedContent": "# Title\\n\\nUpdated content here...",\n  "summary": "Added a new section about X and fixed typo in paragraph 2"\n}';function y(e,t){return a(this,void 0,void 0,(function*(){try{const n=c.join(l.app.getPath("userData"),"config.json"),o=yield d.readFile(n,"utf-8"),i=JSON.parse(o);if(!i.aiModels||!i.aiModels[e])return t;const r=t.filter((t=>{const n=i.aiModels[e][t.id];return!n||!1!==n.enabled}));return(0,u.log)(`Filtered ${e} models`,{total:t.length,enabled:r.length}),r}catch(n){return(0,u.logError)(`Failed to load config for filtering ${e} models, returning all`,n),t}}))}function m(e){return e.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase())).replace(/(\d+)$/g," $1").trim()}},359:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CLAUDE_MODELS=void 0,t.callClaudeApi=function(e){return o(this,arguments,void 0,(function*(e,t="claude-sonnet-4-5-20250514"){var n;const o=(0,r.getApiKeyForService)("claude");if(!o)throw new Error("ANTHROPIC_API_KEY not found. Please set it in Settings");const s={messages:e.map((e=>{if(e.attachments&&e.attachments.length>0){const t=[{type:"text",text:e.content}];for(const n of e.attachments)"image"===n.type?t.push({type:"image",source:{type:"base64",media_type:n.mimeType,data:n.data}}):"text"===n.type&&t.push({type:"text",text:`\n\n[File: ${n.name}]\n${n.data}`});return{role:e.role,content:t}}return{role:e.role,content:e.content}})),model:t,max_tokens:4096};(0,i.log)("Claude API Request",{url:"https://api.anthropic.com/v1/messages",model:t,messageCount:e.length});try{const e=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"X-Api-Key":o,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify(s)});(0,i.log)("Claude API Response Status",{status:e.status,statusText:e.statusText});const t=yield e.json();if(!e.ok)throw new Error(`API request failed with status ${e.status}: ${e.statusText}`);return(null===(n=t.content[0])||void 0===n?void 0:n.text)||"No response from Claude"}catch(e){throw(0,i.logError)("Error calling Claude API",e),new Error(`Failed to call Claude API: ${e instanceof Error?e.message:String(e)}`)}}))},t.callClaudeApiWithSystemPrompt=function(e,t){return o(this,arguments,void 0,(function*(e,t,n="claude-sonnet-4-5-20250514"){var o;const s=(0,r.getApiKeyForService)("claude");if(!s)throw new Error("ANTHROPIC_API_KEY not found. Please set it in Settings");const a={messages:e.map((e=>{if(e.attachments&&e.attachments.length>0){const t=[{type:"text",text:e.content}];for(const n of e.attachments)"image"===n.type?t.push({type:"image",source:{type:"base64",media_type:n.mimeType,data:n.data}}):"text"===n.type&&t.push({type:"text",text:`\n\n[File: ${n.name}]\n${n.data}`});return{role:e.role,content:t}}return{role:e.role,content:e.content}})),model:n,max_tokens:8192,system:t};(0,i.log)("Claude API Request (with system prompt)",{url:"https://api.anthropic.com/v1/messages",model:n,messageCount:e.length});try{const e=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"X-Api-Key":s,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify(a)});(0,i.log)("Claude API Response Status",{status:e.status,statusText:e.statusText});const t=yield e.json();if(!e.ok)throw new Error(`API request failed with status ${e.status}: ${e.statusText}`);return(null===(o=t.content[0])||void 0===o?void 0:o.text)||"No response from Claude"}catch(e){throw(0,i.logError)("Error calling Claude API with system prompt",e),new Error(`Failed to call Claude API: ${e instanceof Error?e.message:String(e)}`)}}))},t.listClaudeModels=function(){return o(this,void 0,void 0,(function*(){const e=(0,r.getApiKeyForService)("claude");if(!e)throw new Error("ANTHROPIC_API_KEY not found. Please set it in Settings");(0,i.log)("Claude List Models Request",{url:"https://api.anthropic.com/v1/models"});try{const t=yield fetch("https://api.anthropic.com/v1/models",{method:"GET",headers:{"X-Api-Key":e,"anthropic-version":"2023-06-01"}});(0,i.log)("Claude List Models Response Status",{status:t.status,statusText:t.statusText});const n=yield t.json();if(!t.ok)throw new Error(`Failed to list models: ${t.status} ${t.statusText}`);return n.data}catch(e){throw(0,i.logError)("Error listing Claude models",e),new Error(`Failed to list Claude models: ${e instanceof Error?e.message:String(e)}`)}}))},t.hasApiKey=function(){return!!(0,r.getApiKeyForService)("claude")},t.validateApiKey=function(e){return o(this,void 0,void 0,(function*(){try{(0,i.log)("Claude: Validating API key");const t=yield fetch("https://api.anthropic.com/v1/models",{method:"GET",headers:{"X-Api-Key":e,"anthropic-version":"2023-06-01"}});if(!t.ok){const e=yield t.text();return(0,i.log)("Claude: API key validation failed",{status:t.status,error:e}),{valid:!1,error:401===t.status?"Invalid API key":`API error: ${t.statusText}`}}return(0,i.log)("Claude: API key validated successfully"),{valid:!0}}catch(e){return(0,i.logError)("Claude: API key validation error",e),{valid:!1,error:`Validation failed: ${e instanceof Error?e.message:"Unknown error"}`}}}))};const i=n(530),r=n(871);t.DEFAULT_CLAUDE_MODELS=[{id:"claude-sonnet-4-5-20250514",displayName:"Claude Sonnet 4.5"},{id:"claude-sonnet-4-20250514",displayName:"Claude Sonnet 4"},{id:"claude-haiku-3-5-20241022",displayName:"Claude Haiku 3.5"}]},530:function(e,t,n){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initLogger=function(){const e=d.app.isPackaged?c.dirname(d.app.getPath("exe")):d.app.getAppPath();u=c.join(e,"markdownplus-debug.log");try{l.writeFile(u,"=== MarkdownPlus Debug Log ===\n","utf-8").catch((()=>{}))}catch(e){}g("Logger initialized",{appPath:e,logFilePath:u,isPackaged:d.app.isPackaged})},t.log=g,t.logError=function(e,t){const n=(new Date).toISOString(),o=Object.assign({message:(null==t?void 0:t.message)||String(t),stack:null==t?void 0:t.stack},t),i=`[${n}] ERROR: ${e}\n${JSON.stringify(o,null,2)}\n\n`;console.error(`[ERROR] ${e}`,t),p.push(i),setTimeout(h,100)},t.flushLogsSync=function(){return a(this,void 0,void 0,(function*(){yield h()}))},t.getLogFilePath=function(){return u};const l=s(n(943)),c=s(n(928)),d=n(157);let u,p=[],f=!1;function h(){return a(this,void 0,void 0,(function*(){if(f||0===p.length)return;f=!0;const e=[...p];p=[];try{yield l.appendFile(u,e.join(""),"utf-8")}catch(e){console.error("Failed to write logs:",e)}finally{f=!1}}))}function g(e,t){const n=(new Date).toISOString(),o=t?`[${n}] ${e}\n${JSON.stringify(t,null,2)}\n\n`:`[${n}] ${e}\n\n`;console.log(`[LOG] ${e}`,t||""),p.push(o),setTimeout(h,100)}},595:function(e,t,n){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.loadEncryptedKeys=function(){try{const e=f();if(!c.existsSync(e))return void(0,d.log)("Secure Storage: No encrypted keys file found (first run)");const t=c.readFileSync(e,"utf-8"),n=JSON.parse(t);for(const[e,t]of Object.entries(n))"string"==typeof t&&p.set(e,Buffer.from(t,"base64"));(0,d.log)("Secure Storage: Loaded encrypted keys from disk",{count:p.size})}catch(e){(0,d.logError)("Failed to load encrypted keys from disk",e)}},t.setApiKey=function(e,t){try{if(!t||""===t.trim())throw new Error("API key cannot be empty");const n=a.safeStorage.encryptString(t),o=`${u}${e}`;p.set(o,n),h(),(0,d.log)("Secure Storage: API key stored",{provider:e})}catch(t){throw(0,d.logError)(`Failed to store API key for ${e}`,t),t}},t.getApiKey=function(e){try{const t=`${u}${e}`,n=p.get(t);return n?a.safeStorage.decryptString(n):null}catch(t){return(0,d.logError)(`Failed to retrieve API key for ${e}`,t),null}},t.hasApiKey=function(e){const t=`${u}${e}`;return p.has(t)},t.deleteApiKey=function(e){try{const t=`${u}${e}`;p.delete(t),h(),(0,d.log)("Secure Storage: API key deleted",{provider:e})}catch(t){throw(0,d.logError)(`Failed to delete API key for ${e}`,t),t}},t.clearAllApiKeys=function(){p.clear(),h(),(0,d.log)("Secure Storage: All API keys cleared")},t.isSecureStorageAvailable=function(){return a.safeStorage.isEncryptionAvailable()};const a=n(157),l=s(n(928)),c=s(n(896)),d=n(530),u="markdownplus_api_key_",p=new Map,f=()=>l.join(a.app.getPath("userData"),"encrypted-keys.json");function h(){try{const e=f(),t={};for(const[e,n]of p.entries())t[e]=n.toString("base64");c.writeFileSync(e,JSON.stringify(t,null,2),"utf-8"),(0,d.log)("Secure Storage: Saved encrypted keys to disk")}catch(e){throw(0,d.logError)("Failed to save encrypted keys to disk",e),e}}},779:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_XAI_MODELS=void 0,t.callXAiApi=function(e){return o(this,arguments,void 0,(function*(e,t="grok-3-fast"){var n,o;const s=(0,r.getApiKeyForService)("xai");if(!s)throw new Error("XAI_API_KEY not found. Please set it in Settings");const a=e.map((e=>{if(e.attachments&&e.attachments.length>0){const t=[{type:"text",text:e.content}];for(const n of e.attachments)"image"===n.type?t.push({type:"image_url",image_url:{url:`data:${n.mimeType};base64,${n.data}`}}):"text"===n.type&&t.push({type:"text",text:`\n\n[File: ${n.name}]\n${n.data}`});return{role:e.role,content:t}}return{role:e.role,content:e.content}}));(0,i.log)("xAI API Request",{url:"https://api.x.ai/v1/chat/completions",model:t,messageCount:e.length});try{const e=yield fetch("https://api.x.ai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({messages:a,model:t})});(0,i.log)("xAI API Response Status",{status:e.status,statusText:e.statusText});const r=yield e.json();if(!e.ok)throw new Error(`API request failed with status ${e.status}: ${e.statusText}`);return(null===(o=null===(n=r.choices[0])||void 0===n?void 0:n.message)||void 0===o?void 0:o.content)||"No response from AI"}catch(e){throw(0,i.logError)("Error calling xAI API",e),new Error(`Failed to call xAI API: ${e instanceof Error?e.message:String(e)}`)}}))},t.listModels=function(){return o(this,void 0,void 0,(function*(){const e=(0,r.getApiKeyForService)("xai");if(!e)throw new Error("XAI_API_KEY not found. Please set it in Settings");(0,i.log)("xAI List Models Request",{url:"https://api.x.ai/v1/models"});try{const t=yield fetch("https://api.x.ai/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`}});(0,i.log)("xAI List Models Response Status",{status:t.status,statusText:t.statusText});const n=yield t.json();if(!t.ok)throw new Error(`Failed to list models: ${t.status} ${t.statusText}`);return n.data}catch(e){throw(0,i.logError)("Error listing xAI models",e),new Error(`Failed to list models: ${e instanceof Error?e.message:String(e)}`)}}))},t.hasApiKey=function(){return!!(0,r.getApiKeyForService)("xai")},t.validateApiKey=function(e){return o(this,void 0,void 0,(function*(){try{(0,i.log)("xAI: Validating API key");const t=yield fetch("https://api.x.ai/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=yield t.text();return(0,i.log)("xAI: API key validation failed",{status:t.status,error:e}),{valid:!1,error:401===t.status?"Invalid API key":`API error: ${t.statusText}`}}return(0,i.log)("xAI: API key validated successfully"),{valid:!0}}catch(e){return(0,i.logError)("xAI: API key validation error",e),{valid:!1,error:`Validation failed: ${e instanceof Error?e.message:"Unknown error"}`}}}))};const i=n(530),r=n(871);t.DEFAULT_XAI_MODELS=[{id:"grok-3-fast",displayName:"Grok 3 Fast"},{id:"grok-3",displayName:"Grok 3"},{id:"grok-3-mini",displayName:"Grok 3 Mini"}]},857:e=>{"use strict";e.exports=require("os")},871:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.registerSecureStorageIpcHandlers=function(){(0,r.log)("Registering Secure Storage IPC handlers"),i.ipcMain.handle("secure-storage:set-api-key",((e,t)=>o(this,void 0,void 0,(function*(){(0,r.log)("Secure Storage IPC: set-api-key",{provider:t.provider});try{let e;switch(t.provider){case"xai":e=yield(0,a.validateApiKey)(t.key);break;case"claude":e=yield(0,l.validateApiKey)(t.key);break;case"openai":e=yield(0,c.validateApiKey)(t.key);break;default:return{success:!1,error:`Unknown provider: ${t.provider}`}}return e.valid?((0,s.setApiKey)(t.provider,t.key),(0,r.log)("Secure Storage IPC: API key validated and stored successfully",{provider:t.provider}),{success:!0}):((0,r.log)("Secure Storage IPC: API key validation failed",{provider:t.provider,error:e.error}),{success:!1,error:e.error||"API key validation failed"})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to store API key"}}})))),i.ipcMain.handle("secure-storage:has-api-key",((e,t)=>o(this,void 0,void 0,(function*(){return(0,r.log)("Secure Storage IPC: has-api-key",{provider:t}),(0,s.hasApiKey)(t)})))),i.ipcMain.handle("secure-storage:delete-api-key",((e,t)=>o(this,void 0,void 0,(function*(){(0,r.log)("Secure Storage IPC: delete-api-key",{provider:t});try{return(0,s.deleteApiKey)(t),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete API key"}}})))),i.ipcMain.handle("secure-storage:get-key-status",(()=>o(this,void 0,void 0,(function*(){return(0,r.log)("Secure Storage IPC: get-key-status"),{xai:(0,s.hasApiKey)("xai"),claude:(0,s.hasApiKey)("claude"),openai:(0,s.hasApiKey)("openai")}})))),i.ipcMain.handle("secure-storage:is-available",(()=>o(this,void 0,void 0,(function*(){return(0,r.log)("Secure Storage IPC: is-available"),(0,s.isSecureStorageAvailable)()}))))},t.getApiKeyForService=function(e){return(0,s.getApiKey)(e)};const i=n(157),r=n(530),s=n(595),a=n(779),l=n(359),c=n(979)},896:e=>{"use strict";e.exports=require("fs")},915:function(e,t,n){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const l=n(157),c=s(n(928)),d=s(n(943)),u=s(n(896)),p=s(n(998)),f=n(530),h=n(337),g=n(871),y=n(595),m=n(779),v=n(359),A=n(979);let I;p.config();let w=[],P=new Map;const E=[".md",".markdown",".mdown",".mkd",".mkdn",".mdx",".mdwn"];function O(e){const t=e.toLowerCase();return E.some((e=>t.endsWith(e)))}const x=()=>{const e=l.app.getPath("userData");return c.join(e,"config.json")},_={recentFiles:[],openFiles:[],defaultLineEnding:"CRLF",devToolsOpen:!1,aiModels:{},silentFileUpdates:!0};function S(e){return e.includes("\r\n")?"CRLF":"LF"}function b(e,t){const n=e.replace(/\r\n/g,"\n");return"CRLF"===t?n.replace(/\n/g,"\r\n"):n}function M(){return a(this,void 0,void 0,(function*(){try{const e=x(),t=yield d.readFile(e,"utf-8"),n=JSON.parse(t);return n.recentFiles&&Array.isArray(n.recentFiles)&&n.recentFiles.length>0&&"string"==typeof n.recentFiles[0]&&(n.recentFiles=[]),n.openFiles&&Array.isArray(n.openFiles)&&n.openFiles.length>0&&"string"==typeof n.openFiles[0]&&(n.openFiles=[]),Object.assign(Object.assign({},_),n)}catch(e){return _}}))}function C(e){return a(this,void 0,void 0,(function*(){try{const t=x();yield d.writeFile(t,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save config:",e)}}))}l.app.whenReady().then((()=>a(void 0,void 0,void 0,(function*(){(0,f.initLogger)(),(0,f.log)("=== App Starting ==="),(0,f.log)("Electron app ready"),(0,f.log)("Config file location",{path:x()}),(0,y.loadEncryptedKeys)();const e=process.argv.slice(1);(0,f.log)("Command line arguments received",{args:e,length:e.length}),w=e.filter((e=>{const t=O(e),n=!e.startsWith("--")&&!e.startsWith("-"),o=t&&n;return(0,f.log)("Filtering argument",{arg:e,isMarkdown:t,isNotFlag:n,included:o}),o})),(0,f.log)("Pending files to open after filtering",{pendingFilesToOpen:w,count:w.length}),(0,f.log)("Registering IPC handlers"),function(){l.ipcMain.handle("file:open",(()=>a(this,void 0,void 0,(function*(){const e=yield l.dialog.showOpenDialog(I,{filters:[{name:"Markup Files",extensions:["md","markdown","mdown","mkd","mkdn","mdx","mdwn","rst","rest"]},{name:"Text Files",extensions:["txt"]},{name:"Other Markup",extensions:["adoc","asciidoc","org","textile"]},{name:"All Files",extensions:["*"]}],properties:["openFile","multiSelections"]});if(e.canceled||0===e.filePaths.length)return null;const t=[];for(const n of e.filePaths)try{const e=yield d.readFile(n,"utf-8"),o=S(e);t.push({filePath:n,content:e,lineEnding:o})}catch(e){console.error(`Failed to read file ${n}:`,e)}return t.length>0?t:null})))),l.ipcMain.handle("file:read",((e,t)=>a(this,void 0,void 0,(function*(){(0,f.log)("IPC: file:read called",{filePath:t});try{const e=yield d.readFile(t,"utf-8"),n=S(e);return(0,f.log)("IPC: file:read success",{filePath:t,contentLength:e.length,lineEnding:n}),{filePath:t,content:e,lineEnding:n}}catch(e){return(0,f.logError)("IPC: file:read failed",e),null}})))),l.ipcMain.handle("file:read-for-attachment",((e,t)=>a(this,void 0,void 0,(function*(){(0,f.log)("IPC: file:read-for-attachment called",{filePath:t});try{const e=c.extname(t).toLowerCase(),n=[".txt",".md",".markdown",".json",".js",".ts",".tsx",".jsx",".css",".html",".xml",".yaml",".yml",".log"];if([".jpg",".jpeg",".png",".gif",".bmp",".webp"].includes(e)){const n=yield d.readFile(t),o=n.toString("base64"),i=".png"===e?"image/png":".jpg"===e||".jpeg"===e?"image/jpeg":".gif"===e?"image/gif":".webp"===e?"image/webp":"image/bmp";return(0,f.log)("IPC: file:read-for-attachment success (image)",{filePath:t,size:n.length}),{type:"image",mimeType:i,data:o,size:n.length}}if(n.includes(e)||!e){const e=yield d.readFile(t,"utf-8");return(0,f.log)("IPC: file:read-for-attachment success (text)",{filePath:t,size:e.length}),{type:"text",data:e,size:e.length}}return{type:"unsupported",error:`File type ${e} is not supported`}}catch(e){return(0,f.logError)("IPC: file:read-for-attachment failed",e),{type:"error",error:e instanceof Error?e.message:"Failed to read file"}}})))),l.ipcMain.handle("file:save",((e,t,n)=>a(this,void 0,void 0,(function*(){try{let e="LF";try{e=S(yield d.readFile(t,"utf-8"))}catch(t){e="win32"===process.platform?"CRLF":"LF"}const o=b(n,e);return yield d.writeFile(t,o,"utf-8"),{success:!0,filePath:t}}catch(e){return console.error("Failed to save file:",e),{success:!1,filePath:t,error:String(e)}}})))),l.ipcMain.handle("file:save-as",((e,t,n)=>a(this,void 0,void 0,(function*(){const e=yield l.dialog.showSaveDialog(I,{defaultPath:n||"Untitled.md",filters:[{name:"Markdown",extensions:["md"]},{name:"Text Files",extensions:["txt"]},{name:"All Files",extensions:["*"]}]});if(e.canceled||!e.filePath)return null;try{const n="win32"===process.platform?"CRLF":"LF",o=b(t,n);return yield d.writeFile(e.filePath,o,"utf-8"),{success:!0,filePath:e.filePath}}catch(t){return console.error("Failed to save file:",t),{success:!1,filePath:e.filePath,error:String(t)}}})))),l.ipcMain.handle("file:rename",((e,t,n)=>a(this,void 0,void 0,(function*(){try{return yield d.rename(t,n),{success:!0}}catch(e){throw console.error("Failed to rename file:",e),e}})))),l.ipcMain.handle("config:load",(()=>a(this,void 0,void 0,(function*(){return yield M()})))),l.ipcMain.handle("config:save",((e,t)=>a(this,void 0,void 0,(function*(){yield C(t)})))),l.ipcMain.handle("config:open",(()=>a(this,void 0,void 0,(function*(){return yield function(){return a(this,void 0,void 0,(function*(){const e=x();try{try{yield d.access(e)}catch(t){yield d.writeFile(e,JSON.stringify(_,null,2),"utf-8")}const t=yield d.readFile(e,"utf-8");return{filePath:e,content:t,lineEnding:S(t)}}catch(e){return console.error("Failed to open config file:",e),null}}))}()})))),l.ipcMain.handle("get-initial-files",(()=>{(0,f.log)("IPC: get-initial-files called",{pendingFiles:w});const e=w;return w=[],(0,f.log)("IPC: Returning files and clearing pending",{files:e}),e})),l.ipcMain.handle("renderer-ready",(()=>{if((0,f.log)("IPC: renderer-ready called",{pendingFiles:w}),w.length>0&&I&&!I.isDestroyed()){(0,f.log)("Sending files to renderer after ready signal",{files:w}),I.webContents.send("open-files-from-args",w),(0,f.log)('IPC event "open-files-from-args" sent to renderer');const e=[...w];return w=[],(0,f.log)("Returning files from renderer-ready",{files:e}),e}return(0,f.log)("No files to send from renderer-ready"),[]})),l.ipcMain.handle("config:sync-recent-files",((e,t)=>a(this,void 0,void 0,(function*(){const e=yield M(),n=Object.assign(Object.assign({},e),{recentFiles:t,openFiles:t});yield C(n)})))),l.ipcMain.handle("dialog:confirm-close",((e,t)=>a(this,void 0,void 0,(function*(){return{action:["save","discard","cancel"][(yield l.dialog.showMessageBox(I,{type:"question",buttons:["Save","Don't Save","Cancel"],defaultId:0,cancelId:2,title:"Unsaved Changes",message:`Do you want to save changes to "${t}"?`,detail:"Your changes will be lost if you don't save them."})).response]}})))),l.ipcMain.handle("devtools:toggle",(()=>a(this,void 0,void 0,(function*(){return!(!I||I.isDestroyed()||(I.webContents.isDevToolsOpened()?(I.webContents.closeDevTools(),1):(I.webContents.openDevTools(),0)))})))),l.ipcMain.handle("devtools:get-state",(()=>a(this,void 0,void 0,(function*(){return!(!I||I.isDestroyed())&&I.webContents.isDevToolsOpened()})))),l.ipcMain.handle("log:get-path",(()=>(0,f.getLogFilePath)())),l.ipcMain.on("console:log",((e,t,...n)=>{const o=n.map((e=>"object"==typeof e?JSON.stringify(e):String(e))).join(" ");(0,f.log)(`[RENDERER ${t.toUpperCase()}] ${o}`)})),l.ipcMain.handle("dialog:external-change",((e,t)=>a(this,void 0,void 0,(function*(){return 0===(yield l.dialog.showMessageBox(I,{type:"question",buttons:["Yes","No"],defaultId:0,title:"File Changed Externally",message:`"${t}" has been changed externally.`,detail:"Would you like to refresh it with the latest changes?"})).response?"reload":"keep"})))),l.ipcMain.handle("dialog:open-file",((e,t)=>a(this,void 0,void 0,(function*(){return yield l.dialog.showOpenDialog(I,{properties:t.properties})})))),l.ipcMain.handle("window:set-title",((e,t)=>a(this,void 0,void 0,(function*(){null==I||I.setTitle(t)})))),l.ipcMain.handle("window:get-bounds",(()=>a(this,void 0,void 0,(function*(){return null==I?void 0:I.getBounds()})))),l.ipcMain.handle("window:minimize",(()=>a(this,void 0,void 0,(function*(){null==I||I.minimize()})))),l.ipcMain.handle("window:maximize",(()=>a(this,void 0,void 0,(function*(){(null==I?void 0:I.isMaximized())?I.unmaximize():null==I||I.maximize()})))),l.ipcMain.handle("window:close",(()=>a(this,void 0,void 0,(function*(){null==I||I.close()})))),l.ipcMain.handle("shell:show-in-folder",((e,t)=>a(this,void 0,void 0,(function*(){l.shell.showItemInFolder(t)})))),l.ipcMain.handle("shell:open-external",((e,t)=>a(this,void 0,void 0,(function*(){yield l.shell.openExternal(t)})))),l.ipcMain.handle("file:watch",((e,t)=>a(this,void 0,void 0,(function*(){!function(e){if(!P.has(e))try{const t=u.watch(e,(t=>{"change"===t&&((0,f.log)("File changed externally",{filePath:e}),I&&!I.isDestroyed()&&I.webContents.send("file:external-change",e))}));P.set(e,t),(0,f.log)("Started watching file",{filePath:e})}catch(t){(0,f.logError)(`Failed to watch file: ${e}`,t)}}(t)})))),l.ipcMain.handle("file:unwatch",((e,t)=>a(this,void 0,void 0,(function*(){!function(e){const t=P.get(e);t&&(t.close(),P.delete(e),(0,f.log)("Stopped watching file",{filePath:e}))}(t)}))))}(),(0,h.registerAIIpcHandlers)(),(0,g.registerSecureStorageIpcHandlers)(),(0,f.log)("Syncing AI models config"),yield function(){return a(this,void 0,void 0,(function*(){try{const e=yield M();e.aiModels||(e.aiModels={});let t=!1;if((0,m.hasApiKey)())try{const n=yield(0,m.listModels)();e.aiModels.xai||(e.aiModels.xai={},t=!0);for(const o of n)e.aiModels.xai[o.id]||(e.aiModels.xai[o.id]={enabled:!0},t=!0,(0,f.log)("Added new xAI model to config",{modelId:o.id}))}catch(e){(0,f.logError)("Failed to sync xAI models",e)}if((0,v.hasApiKey)())try{const n=yield(0,v.listClaudeModels)();e.aiModels.claude||(e.aiModels.claude={},t=!0);for(const o of n)e.aiModels.claude[o.id]||(e.aiModels.claude[o.id]={enabled:!0},t=!0,(0,f.log)("Added new Claude model to config",{modelId:o.id}))}catch(e){(0,f.logError)("Failed to sync Claude models",e)}if((0,A.hasApiKey)())try{const n=yield(0,A.listOpenAIModels)();e.aiModels.openai||(e.aiModels.openai={},t=!0);for(const o of n)e.aiModels.openai[o.id]||(e.aiModels.openai[o.id]={enabled:!0},t=!0,(0,f.log)("Added new OpenAI model to config",{modelId:o.id}))}catch(e){(0,f.logError)("Failed to sync OpenAI models",e)}t&&(yield C(e),(0,f.log)("AI models config synced and saved"))}catch(e){(0,f.logError)("Failed to sync AI models config",e)}}))}(),l.Menu.setApplicationMenu(null),(0,f.log)("Creating main window"),function(){I=new l.BrowserWindow({width:1200,height:800,minWidth:600,minHeight:400,frame:!1,icon:c.join(__dirname,"assets","win32"===process.platform?"icon.ico":"MarkdownPlus.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}}),I.loadFile(c.join(__dirname,"index.html")),M().then((e=>{e.devToolsOpen&&I&&!I.isDestroyed()&&((0,f.log)("Opening DevTools from config",{devToolsOpen:e.devToolsOpen}),I.webContents.openDevTools())})),I.webContents.on("devtools-opened",(()=>a(this,void 0,void 0,(function*(){(0,f.log)("DevTools opened via native UI");const e=yield M();yield C(Object.assign(Object.assign({},e),{devToolsOpen:!0}))})))),I.webContents.on("devtools-closed",(()=>a(this,void 0,void 0,(function*(){(0,f.log)("DevTools closed via native UI");const e=yield M();yield C(Object.assign(Object.assign({},e),{devToolsOpen:!1}))})))),I.on("closed",(()=>{I=null}))}(),(0,f.log)("Main window created")})))),l.app.on("second-instance",((e,t)=>{(0,f.log)("Second instance detected",{commandLine:t}),I&&(I.isMinimized()&&I.restore(),I.focus());const n=t.slice(1);(0,f.log)("Second instance args",{args:n});const o=n.filter((e=>{const t=O(e),n=!e.startsWith("--")&&!e.startsWith("-");return t&&n}));(0,f.log)("Second instance files to open",{filesToOpen:o}),o.length>0&&I&&!I.isDestroyed()&&((0,f.log)("Sending second instance files to renderer",{filesToOpen:o}),I.webContents.send("open-files-from-args",o))})),l.app.requestSingleInstanceLock()||l.app.quit(),l.app.on("before-quit",(()=>a(void 0,void 0,void 0,(function*(){(0,f.log)("App quitting, flushing logs"),yield(0,f.flushLogsSync)()}))))},928:e=>{"use strict";e.exports=require("path")},943:e=>{"use strict";e.exports=require("fs/promises")},979:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OPENAI_MODELS=void 0,t.callOpenAIApi=function(e){return o(this,arguments,void 0,(function*(e,t="gpt-4o-mini-latest"){var n,o;const s=(0,r.getApiKeyForService)("openai");if(!s)throw new Error("OPENAI_API_KEY not found. Please set it in Settings");const a=e.map((e=>{if(e.attachments&&e.attachments.length>0){const t=[{type:"text",text:e.content}];for(const n of e.attachments)"image"===n.type?t.push({type:"image_url",image_url:{url:`data:${n.mimeType};base64,${n.data}`}}):"text"===n.type&&t.push({type:"text",text:`\n\n[File: ${n.name}]\n${n.data}`});return{role:e.role,content:t}}return{role:e.role,content:e.content}}));(0,i.log)("OpenAI API Request",{url:"https://api.openai.com/v1/chat/completions",model:t,messageCount:e.length});try{const e=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({messages:a,model:t})});(0,i.log)("OpenAI API Response Status",{status:e.status,statusText:e.statusText});const r=yield e.json();if(!e.ok)throw new Error(`API request failed with status ${e.status}: ${e.statusText}`);return(null===(o=null===(n=r.choices[0])||void 0===n?void 0:n.message)||void 0===o?void 0:o.content)||"No response from OpenAI"}catch(e){throw(0,i.logError)("Error calling OpenAI API",e),new Error(`Failed to call OpenAI API: ${e instanceof Error?e.message:String(e)}`)}}))},t.callOpenAIApiWithJsonMode=function(e){return o(this,arguments,void 0,(function*(e,t="gpt-4o-mini-latest"){var n,o;const s=(0,r.getApiKeyForService)("openai");if(!s)throw new Error("OPENAI_API_KEY not found. Please set it in Settings");(0,i.log)("OpenAI API Request (JSON mode)",{url:"https://api.openai.com/v1/chat/completions",model:t,messageCount:e.length});try{const r=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({messages:e,model:t,response_format:{type:"json_object"}})});(0,i.log)("OpenAI API Response Status (JSON mode)",{status:r.status,statusText:r.statusText});const a=yield r.json();if(!r.ok)throw new Error(`API request failed with status ${r.status}: ${r.statusText}`);return(null===(o=null===(n=a.choices[0])||void 0===n?void 0:n.message)||void 0===o?void 0:o.content)||""}catch(e){throw(0,i.logError)("Error calling OpenAI API with JSON mode",e),new Error(`Failed to call OpenAI API: ${e instanceof Error?e.message:String(e)}`)}}))},t.listOpenAIModels=function(){return o(this,void 0,void 0,(function*(){const e=(0,r.getApiKeyForService)("openai");if(!e)throw new Error("OPENAI_API_KEY not found. Please set it in Settings");(0,i.log)("OpenAI List Models Request",{url:"https://api.openai.com/v1/models"});try{const t=yield fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`}});(0,i.log)("OpenAI List Models Response Status",{status:t.status,statusText:t.statusText});const n=yield t.json();if(!t.ok)throw new Error(`Failed to list models: ${t.status} ${t.statusText}`);return n.data.filter((e=>e.id.startsWith("gpt-")&&e.id.includes("-latest")))}catch(e){throw(0,i.logError)("Error listing OpenAI models",e),new Error(`Failed to list models: ${e instanceof Error?e.message:String(e)}`)}}))},t.hasApiKey=function(){return!!(0,r.getApiKeyForService)("openai")},t.validateApiKey=function(e){return o(this,void 0,void 0,(function*(){try{(0,i.log)("OpenAI: Validating API key");const t=yield fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=yield t.text();return(0,i.log)("OpenAI: API key validation failed",{status:t.status,error:e}),{valid:!1,error:401===t.status?"Invalid API key":`API error: ${t.statusText}`}}return(0,i.log)("OpenAI: API key validated successfully"),{valid:!0}}catch(e){return(0,i.logError)("OpenAI: API key validation error",e),{valid:!1,error:`Validation failed: ${e instanceof Error?e.message:"Unknown error"}`}}}))};const i=n(530),r=n(871);t.DEFAULT_OPENAI_MODELS=[{id:"gpt-4o-latest",displayName:"GPT-4 Omni Latest"},{id:"gpt-4o-mini-latest",displayName:"GPT-4 Omni Mini Latest"},{id:"gpt-4-turbo-latest",displayName:"GPT-4 Turbo Latest"}]},982:e=>{"use strict";e.exports=require("crypto")},998:(e,t,n)=>{const o=n(896),i=n(928),r=n(857),s=n(982),a=n(56).version,l=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function c(e){console.log(`[dotenv@${a}][DEBUG] ${e}`)}function d(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function u(e,t){let n;try{n=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const o=n.password;if(!o){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const i=n.searchParams.get("environment");if(!i){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const r=`DOTENV_VAULT_${i.toUpperCase()}`,s=e.parsed[r];if(!s){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${r} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:s,key:o}}function p(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const n of e.path)o.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=i.resolve(process.cwd(),".env.vault");return o.existsSync(t)?t:null}function f(e){return"~"===e[0]?i.join(r.homedir(),e.slice(1)):e}const h={configDotenv:function(e){const t=i.resolve(process.cwd(),".env");let n="utf8";const r=Boolean(e&&e.debug);e&&e.encoding?n=e.encoding:r&&c("No encoding is specified. UTF-8 is used by default");let s,a=[t];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const t of e.path)a.push(f(t))}else a=[f(e.path)];const l={};for(const t of a)try{const i=h.parse(o.readFileSync(t,{encoding:n}));h.populate(l,i,e)}catch(e){r&&c(`Failed to load ${t} ${e.message}`),s=e}let d=process.env;return e&&null!=e.processEnv&&(d=e.processEnv),h.populate(d,l,e),s?{parsed:l,error:s}:{parsed:l}},_configVault:function(e){Boolean(e&&e.debug)&&c("Loading env from encrypted .env.vault");const t=h._parseVault(e);let n=process.env;return e&&null!=e.processEnv&&(n=e.processEnv),h.populate(n,t,e),{parsed:t}},_parseVault:function(e){const t=p(e),n=h.configDotenv({path:t});if(!n.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const o=d(e).split(","),i=o.length;let r;for(let e=0;e<i;e++)try{const t=u(n,o[e].trim());r=h.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=i)throw t}return h.parse(r)},config:function(e){if(0===d(e).length)return h.configDotenv(e);const t=p(e);return t?h._configVault(e):(n=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${a}][WARN] ${n}`),h.configDotenv(e));var n},decrypt:function(e,t){const n=Buffer.from(t.slice(-64),"hex");let o=Buffer.from(e,"base64");const i=o.subarray(0,12),r=o.subarray(-16);o=o.subarray(12,-16);try{const e=s.createDecipheriv("aes-256-gcm",n,i);return e.setAuthTag(r),`${e.update(o)}${e.final()}`}catch(e){const t=e instanceof RangeError,n="Invalid key length"===e.message,o="Unsupported state or unable to authenticate data"===e.message;if(t||n){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(o){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let n,o=e.toString();for(o=o.replace(/\r\n?/gm,"\n");null!=(n=l.exec(o));){const e=n[1];let o=n[2]||"";o=o.trim();const i=o[0];o=o.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===i&&(o=o.replace(/\\n/g,"\n"),o=o.replace(/\\r/g,"\r")),t[e]=o}return t},populate:function(e,t,n={}){const o=Boolean(n&&n.debug),i=Boolean(n&&n.override);if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const n of Object.keys(t))Object.prototype.hasOwnProperty.call(e,n)?(!0===i&&(e[n]=t[n]),o&&c(!0===i?`"${n}" is already defined and WAS overwritten`:`"${n}" is already defined and was NOT overwritten`)):e[n]=t[n]}};e.exports.configDotenv=h.configDotenv,e.exports._configVault=h._configVault,e.exports._parseVault=h._parseVault,e.exports.config=h.config,e.exports.decrypt=h.decrypt,e.exports.parse=h.parse,e.exports.populate=h.populate,e.exports=h}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(915)})();